<section class="tu-storage">
  <div class="storage-grid">
    <button
      mat-raised-button
      class="button-color-primary"
      (click)="addExternalStorage()"
      [style]="'margin: 5px; font-weight: normal'">
      {{ "dmp.steps.storage.external.add" | translate }}
    </button>
  </div>
  <div class="storage-selected">
    <ng-container>
      <mat-card
        class="card-shadow"
        appearance="raised"
        *ngFor="let item of externalStorageStep?.controls; let i = index">
        <div class="storage-card-top">
          <mat-card-header>
            <mat-card-title [class.form-error]="item.invalid">
              {{ item.value.title }}
            </mat-card-title>
          </mat-card-header>
        </div>
        <mat-card-content>
          <div class="form-row">
            <div class="storage-card-top">
              <app-input-wrapper
                [label]="'dmp.steps.storage.external.question.name'"
                [control]="getFormControl(i, 'title')"></app-input-wrapper>
            </div>
            <button
              mat-icon-button
              aria-label="{{ 'dmp.steps.storage.external.remove' | translate }}"
              (click)="removeExternalStorage(i)">
              <mat-icon class="material-icon-primary">cancel</mat-icon>
            </button>
          </div>
          <div class="form-row">
            <div class="storage-card-container">
              <mat-form-field class="full-width">
                <mat-label>{{
                  "dmp.steps.storage.question.datasets" | translate
                }}</mat-label>
                <mat-select
                  multiple
                  [formControl]="getFormControl(i, 'datasets')">
                  <mat-option
                    *ngFor="let dataset of datasets?.controls"
                    [value]="dataset.value.referenceHash">
                    {{ dataset.value.title }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <app-input-wrapper
                [label]="'dmp.steps.storage.external.question.location'"
                [control]="
                  getFormControl(i, 'storageLocation')
                "></app-input-wrapper>
            </div>
          </div>
          <div class="form-row">
            <div class="storage-card-top">
              <app-input-wrapper
                [label]="'dmp.steps.storage.external.question.backup.frequency'"
                [control]="
                  getFormControl(i, 'backupFrequency')
                "></app-input-wrapper>
              <app-input-wrapper
                [label]="'dmp.steps.storage.external.question.backup.location'"
                [control]="
                  getFormControl(i, 'backupLocation')
                "></app-input-wrapper>
            </div>
          </div>
        </mat-card-content>
        <mat-card-actions>
          <mat-slide-toggle
            [formControl]="getFormControl(i, 'isManagedInternally')">
            {{
              "dmp.steps.storage.external.question.isManagedInternally"
                | translate
            }}
          </mat-slide-toggle>
        </mat-card-actions>
      </mat-card>
    </ng-container>
    <div
      *ngIf="externalStorageStep?.controls.length && anyNonInternalStorage()"
      class="storage-textarea">
      <app-textarea-wrapper
        [label]="'dmp.steps.storage.external.question.info'"
        [control]="externalStorageInfo">
      </app-textarea-wrapper>
    </div>
  </div>
</section>
